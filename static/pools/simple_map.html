<!DOCTYPE html>
<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />

<title>Map Example</title>

<style type="text/css">
  html { height: 100% }
  body { height: 100%; margin: 0; padding: 0 }
  #map { height: 100% }
</style>

<script type="text/javascript">

function placeMarker(map, lat, lng, comment) {
  var contentString = "<div>"+comment+"</div>";
  var marker = new google.maps.Marker({
    position: {lat:lat, lng:lng},
    map: map,
    animation: google.maps.Animation.DROP
  });
  var infoWindow = new google.maps.InfoWindow({
    content: contentString
  });
  google.maps.event.addListener(marker, 'click', function () {
    infoWindow.open(map, marker)
  });
  map.panTo({lat:lat, lng:lng});  
  return marker;
}

function placeRect(map, lat, lng) {
    const rectangle = new google.maps.Rectangle({
    strokeColor: "#FF0000",
    strokeOpacity: 0.8,
    strokeWeight: 2,
    fillColor: "#FF0000",
    fillOpacity: 0.35,
    map,
    bounds: {
      north: lat,           
      south: lat - 0.002,  //height of 400px at pool zoom
      east: lng,            
      west: lng - 0.002   
    },
  });
}

let map;
let center = {  lat:43.189531, lng:-79.840854 };

function loadData() {
  let fakedata = [{ 
    lat:center.lat, 
    lng:center.lng, 
    comment:'somewhere'}];
 
  fakedata.forEach((v, i) => {
    //placeMarker(map, v.lat, v.lng, v.comment);
    placeRect(map, v.lat, v.lng);
  });
};

function initMap() {
  console.log('initMap');
  map = new google.maps.Map(document.getElementById("map"), {
    center:center,
    zoom: 11
  });
  
  const coordInfoWindow = new google.maps.InfoWindow();
  let tid;

  loadData();
  update(coordInfoWindow);

  map.addListener("zoom_changed", () => {
    update(coordInfoWindow);
  });

  map.addListener("center_changed", () => {
    //prevent multiple/zitter
    if (tid) window.clearTimeout(tid);

    tid = window.setTimeout(() => {
      update(coordInfoWindow);
    }, 1500);
  });
}

function update(coordInfoWindow) {
  center = { lat: map.getCenter().lat(), lng: map.getCenter().lng() };
  console.log(center);
  coordInfoWindow.setContent(createInfoWindowContent(center, map.getZoom()));
  coordInfoWindow.setPosition(center);
  coordInfoWindow.open(map);
}


const TILE_SIZE = 256;

function createInfoWindowContent(latLng, zoom) {
  const scale = 1 << zoom;
  const worldCoordinate = project(latLng);
  const pixelCoordinate = new google.maps.Point(
    Math.floor(worldCoordinate.x * scale),
    Math.floor(worldCoordinate.y * scale)
  );
  const tileCoordinate = new google.maps.Point(
    Math.floor((worldCoordinate.x * scale) / TILE_SIZE),
    Math.floor((worldCoordinate.y * scale) / TILE_SIZE)
  );
  return [
    "Center at",
    "LatLng: " + `(${latLng.lat},${latLng.lng})`,
    "Zoom level: " + zoom,
    "World Coordinate: " + worldCoordinate,
    "Pixel Coordinate: " + pixelCoordinate,
    "Tile Coordinate: " + tileCoordinate,
  ].join("<br>");
}

// The mapping between latitude, longitude and pixels is defined by the web
// mercator projection.
function project(latLng) {
  let siny = Math.sin((latLng.lat * Math.PI) / 180);
  // Truncating to 0.9999 effectively limits latitude to 89.189. This is
  // about a third of a tile past the edge of the world tile.
  siny = Math.min(Math.max(siny, -0.9999), 0.9999);
  return new google.maps.Point(
    TILE_SIZE * (0.5 + latLng.lng / 360),
    TILE_SIZE * (0.5 - Math.log((1 + siny) / (1 - siny)) / (4 * Math.PI))
  );
}

</script>

<title>Somewhere</title>

</head><body>

<div id="map"/>

<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDJHNZPgCpEYbDmr_dn6Y66U0jXxzeeErQ&callback=initMap" async> </script>

</body> </html>